function ColorPicker(id,skinPath,dropDownMenu,defaultColors){ this.IsIE=document.all? true : false; this.ID=id; this.SkinPath=skinPath+"D\x69\x61logs\x2f"; this.DropDownMenu=dropDownMenu; this.ColorSampleElement=document.getElementById('MENU_\x42UTTON_\x53PAN_'+this.ID); this.DefaultColors=defaultColors; this.ItemsPerRow=6; this.CanAddCustomColor= true; this.CanAddHexColor= true; if (null!=this.DropDownMenu){ this.BuildColorTable( ); } this.SelectedColor=""; this.SelectColor(""); this.OnClientClick=null; }ColorPicker.prototype.SetColors= function (colorsArray){ this.DefaultColors=colorsArray; this.BuildColorTable( ); };ColorPicker.prototype.GetXImageUrl= function ( ){return "url("+this.SkinPath+"\x78.gif\x29"; };ColorPicker.prototype.Enable= function (isEnabled){if (null!=this.DropDownMenu){ this.DropDownMenu.Enable(isEnabled); }} ; ColorPicker.prototype.Toggle= function ( ){if (null!=this.DropDownMenu){ this.DropDownMenu.Toggle( ); }} ; ColorPicker.prototype.SelectColor= function (color,hide){color=this.ValidateColor(color); this.SelectedColor=color; if (null==hide)hide= true; if (hide && null!=this.DropDownMenu && this.DropDownMenu.IsVisible( )){ this.DropDownMenu.SetVisible( false); } this.OnChangeSelection( ); } ; ColorPicker.prototype.OnChangeSelection= function ( ){if (null!=this.DropDownMenu && null!=this.ColorSampleElement){if (""==this.SelectedColor){ this.ColorSampleElement.style.background=this.SelectedColor; this.ColorSampleElement.style.backgroundImage=this.GetXImageUrl( ); this.ColorSampleElement.style.backgroundPosition="\x63en\x74\145\x72"; this.ColorSampleElement.style.backgroundRepeat="no-repea\x74"; }else { this.ColorSampleElement.style.backgroundImage=""; this.ColorSampleElement.style.background=this.SelectedColor; }if (this.OnClientClick){ this.OnClientClick( ); }}} ; ColorPicker.prototype.BuildColorTable= function ( ){var table=document.getElementById("\x43OLOR_TA\x42\x4cE\x5f"+this.ID); if (!table)return; var rowLength=table.rows.length; for (var i=0; i<rowLength; i++){table.deleteRow(0); }var oRow=null; var curRowItems=0; for (i=0; i<this.DefaultColors.length; i++){if (0==i%this.ItemsPerRow){oRow=table.insertRow(-1); curRowItems=0; }curRowItems++; var bgColor=this.DefaultColors[i]; this.AddColorCell(oRow,bgColor); }var cellsToAdd=this.ItemsPerRow-curRowItems-1; if (cellsToAdd>0){for (var i=0; i<=cellsToAdd; i++){var oCell=oRow.insertCell(oRow.cells.length); oCell.innerHTML="&n\x62\x73p;&nbs\x70;"; }}if (this.CanAddCustomColor){if (this.IsIE)this.AddCustomColorIE(table); else this.AddHexColor(table,localization["AddCus\x74omColo\x72"]); }if (this.IsIE && this.CanAddHexColor){var sAddHexColor=localization["\x41ddHexCo\x6c\157r"]; if ("\x75ndefine\x64"==typeof sAddHexColor){sAddHexColor=localization["AddCus\x74omHexC\x6flor"]; } this.AddHexColor(table,sAddHexColor); }if (this.IsIE)this.DropDownMenu.SetMenuInnerHtml(table.outerHTML); } ; ColorPicker.prototype.AddCustomColorIE= function (table){var onClickHandler=this.ID+"\x2eOnAd\x64\x43u\x73\164\x6fmCol\x6frIE()"; var i1="\101\x64d Cu\x73tom Colo\x72\056\x2e."; if (localization){i1=localization["AddCu\x73tomColo\x72"]; }var cellInnerHTML="\x3cspan cl\x61\x73s\x3d\x27La\x62el\047\076"+i1+"\x3c/span>"+"\074\x6fbj\x65\143\x74 id=\047\x44LG\x5fSELECT_\x43OLOR_"+this.ID+"\047\x20CLAS\x53ID=\047\x63lsid\x3a3050f81\x39-98b5-\x311cf-bb\x382-00\x61a00bd\x63e0b\047\040\x77idth\x3d\047\x30px\047 heig\x68t=\0470px\047\076\x3c/obj\x65ct>"; this.AddCustomColor(table,onClickHandler,cellInnerHTML); } ; ColorPicker.prototype.AddHexColor= function (table,label){var onClickHandler=this.ID+"\x2eOnAddHe\x78\103\x6flor()"; var cellInnerHTML="\x3cspan cl\x61\163\x73=\047Label\x27\x3e"+label+"\074\057\x73\160\x61\156\x3e"; this.AddCustomColor(table,onClickHandler,cellInnerHTML); } ; ColorPicker.prototype.AddCustomColor= function (table,onClickHandler,cellInnerHtml){var row=table.insertRow(-1); var cell=row.insertCell(row.cells.length); cell.colSpan=this.ItemsPerRow; cell.noWrap= true; cell.setAttribute("\x6fnm\x6f\x75se\x6fver","this.c\x6c\141\x73sName =\x20\047\x4fver\047"); cell.setAttribute("\x6fn\x6d\x6fus\x65out","this.cl\x61\163\x73\116\x61\155\x65\040\x3d \047\x27"); if (""!=onClickHandler)cell.setAttribute("\x6fncl\x69\143\x6b",onClickHandler); cell.innerHTML=cellInnerHtml; } ; ColorPicker.prototype.OnAddCustomColorIE= function ( ){var dlg=document.all["DLG\x5fSELECT_\x43OLOR_"+this.ID]; if (!dlg)return; var color=dlg.ChooseColorDlg( ); color=this.ConvertColor(color); this.OnAddCustomColor(color); } ; ColorPicker.prototype.ValidateColor= function (color){if (null==color)return ""; var re=/\x52\x47\x42\x28\s*(\d{1,3})\s*\x2c\s*(\d{1,3})\s*\x2c\s*(\d{1,3})\s*\x29.*/i; color=color.replace(re, function ($0_match,I1,o2,O2){return toHex(I1)+toHex(o2)+toHex(O2); } ); if (color.charAt(0)!="\x23"){color="#"+color; }re=new RegExp("#[0-9a-f\x41-F]{6}","\x67i"); return re.exec(color)?color: ""; function toHex(l2){var i2=new Ektron.String(parseInt(l2,10).toString(16)); return i2.padLeft(2,"\060"); }} ; ColorPicker.prototype.OnAddCustomColor= function (color){color=this.ValidateColor(color); this.SelectColor(color, true); } ; ColorPicker.prototype.AddCustomColorToColorTable= function (color){var table=document.getElementById("CO\x4cOR_TABL\x45_"+this.ID); if (!table)return; var custColorRow=null; var extraRowsCount=0; if (this.CanAddCustomColor)extraRowsCount++; if (this.CanAddHexColor)extraRowsCount++; if (table.rows.length>((this.DefaultColors.length/this.ItemsPerRow)+extraRowsCount)){var lastRow=table.rows[table.rows.length-1]; if (lastRow.cells.length<this.ItemsPerRow)custColorRow=lastRow; }if (!custColorRow)custColorRow=table.insertRow(-1); this.AddColorCell(custColorRow,color); if (this.IsIE)this.DropDownMenu.SetMenuInnerHtml(table.outerHTML); } ; ColorPicker.prototype.AddColorCell= function (row,color){var cell=row.insertCell(row.cells.length); cell.setAttribute("o\x6emouseove\x72","this\x2e\143\x6cassName\x20= \047\117\x76er\047"); cell.setAttribute("on\x6douseout","\x74his.cla\x73\x73N\x61\155\x65 = \047\x27"); cell.setAttribute("\157\x6eclick",this.ID+".Selec\x74Color(\047"+color+"\047\x29"); var colorBox=document.createElement("DIV"); colorBox.style.backgroundColor=color; if (""==color){cell.style.backgroundImage=this.GetXImageUrl( ); cell.style.backgroundRepeat="\x6eo-rep\x65\x61t"; cell.style.backgroundPosition="center"; }cell.appendChild(colorBox); } ; ColorPicker.prototype.OnAddHexColor= function ( ){var color=prompt(localization["\x50r\x6f\x6dptC\x6flor"],"#"); this.OnAddCustomColor(color); } ; ColorPicker.prototype.ConvertColor= function (color){color=parseInt(color); color=color.toString(16); if (color.length<6){var sTempString="000000".substring(0,(6-color.length)); color="#"+sTempString.concat(color).toUpperCase( ); }else {color="\x23"+color.toUpperCase( ); }return color; } ; ColorPicker.prototype.Toggle= function ( ){if (null!=this.DropDownMenu){ this.DropDownMenu.Toggle( ); if (window.event){window.event.cancelBubble= true; }}} ;
